# 🧠 세그트리 구현 사고 흐름 기록: "최대 두 수의 합" 문제

## 📍 문제 개요

주어진 수열에서 반복적으로 구간 쿼리를 받아  
> 해당 구간 내 **가장 큰 두 수의 합**을 구하는 문제

---

## 🧩 초기 설계 사고

1. **문제 구조 파악**
   - 단순한 `최댓값`이 아니라, **두 개의 최댓값**이 필요
   - 따라서 세그트리의 각 노드가 단일값이 아닌 **두 개의 값을 저장**해야 한다고 판단

2. **노드 구성 설계**
   - 각 노드가 `{max1, max2}` 형태로,  
     가장 큰 수와 그 다음 큰 수를 유지해야 한다고 설정함

3. **병합(pull) 방식 고민**
   - 두 자식 노드로부터 네 개의 후보 값이 존재할 수 있다는 점에 착안
   - 이 중 상위 두 개를 선택해 부모 노드를 구성하는 방식으로 설계

---

## 🚧 시행착오와 오류 분석

> ❌ `query()` 함수 내에서 조건 분기로 일찍 `return` 해버리는 실수를 함

- 구간이 완전히 포함되는 경우 외에도,  
  **겹치는 경우(left + right)**를 병합해야 하는 상황에서  
  분기 구조로 인해 병합 자체가 수행되지 않음

- 이는 세그트리의 기본 원칙 중 하나인  
  **"분할 후 병합"**의 사고를 흐려버린 구조적 실수였음

---

## 🛠 문제 해결 사고 흐름

1. **조건 분기 제거 → 항상 left/right 분할 후 merge하도록 수정**
2. **merge 병합 방식 통일**
   - 병합 시 항상 네 개 후보값을 모은 뒤 정렬
   - 상위 두 값을 선택해 `max1`, `max2` 결정
3. 이 과정을 통해 쿼리 정확성과 범용성을 확보

---

## ✨ 내가 배운 것

- **“구간 병합” 문제는 항상 merge를 의심하라**  
  일찍 return 해도 되는 건 완전 포함/배제된 경우뿐이다
- **병합 전략을 정형화하면 구현 실수 줄어든다**  
  정렬 + 상위 2개 선택 방식이 가장 안정적이고 직관적이었다
- **세그트리는 단순 자료구조가 아닌 "생각 구조화 훈련기"다**  
  잘못된 추상화 하나가 전체 구조를 무너뜨릴 수 있음을 경험함

---

## 🔚 마무리

이번 구현은 단순한 세그트리 구현을 넘어  
**트리 구조 사고의 기초를 훈련하는 계기**였고,  
문제보다 **내 사고 습관의 구조적 약점을 돌아보는 기회**가 되었다.
